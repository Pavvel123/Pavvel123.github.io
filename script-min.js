const SEMESTER_START="2026-02-23",SEMESTER_WEEKS=18,C_W="#55a2eb",C_C="#ef569d",C_L="#9f7edb",C_P="#ef9e58",C_S="#f5ef36";function range(e,t,a=1){const r=[];for(let n=e;n<=t;n+=a)r.push(n);return r}function fmtDM(e){return`${String(e.getDate())}.${String(e.getMonth()+1).padStart(2,"0")}`}function weekDateRange(e){const t=new Date(SEMESTER_START);t.setDate(t.getDate()+7*(e-1));const a=new Date(t);return a.setDate(a.getDate()+6),{start:t,end:a}}function normalizeToStudyDay(e){const t=new Date(e),a=t.getDay();return 6===a?(t.setDate(t.getDate()+2),t):0===a?(t.setDate(t.getDate()+1),t):t}function weekNumberForDate(e){const t=new Date(SEMESTER_START),a=new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=Math.floor(a/864e5);let n=Math.floor(r/7)+1;return n<1&&(n=1),n>SEMESTER_WEEKS&&(n=SEMESTER_WEEKS),n}const EVENTS=[
{id:"XBG",title:"Obowiązuje plan z wtorku!",day:3,start:"07:30",end:"22:00",place:"",teacher:"",color:"#007413ff",weeks:[6]},//1.04

{id:"RPI",title:"Realizacja projektu informatycznego",color:C_P,day:1,weeks:[3,5,8,10,12,14,16],start:"09:15",end:"11:00",place:"WP 122",teacher:"dr inż. Katarzyna Łukasiewicz"},
{id:"TRP",title:"Technika radia programowalnego dla info - zajęcia wprowadzające",color:C_L,day:1,weeks:[10],start:"09:15",end:"11:00",place:"NE 209",teacher:"dr inż. Andrzej Marczak"},
{id:"TRP",title:"Technika radia programowalnego dla info - przedmiot obieralny",color:C_L,day:1,weeks:[11,12,13,14,15,16],start:"09:15",end:"12:00",place:"EA 407",teacher:"dr inż. Andrzej Marczak"},
{id:"BW",title:"Bazy wiedzy",color:C_W,day:1,weeks:[1,2,3,4,5,6,8],start:"13:15",end:"15:00",place:"NE AUD2",teacher:"dr inż. Wojciech Waloszek"},
{id:"ED",title:"Eksploracja danych",color:C_W,day:1,weeks:[1,2,3,4,5,6,8],start:"15:15",end:"17:00",place:"NE AUD2",teacher:"dr inż. Wojciech Waloszek"},
{id:"ZFI",title:"Zarządzanie firmą informatyczną",color:C_P,day:1,weeks:[9,10,11,12,13,14,15,16],start:"15:15",end:"17:00",place:"NE 237",teacher:"dr inż. Paweł Jakóbczyk"},
{id:"WZR",title:"Wirtualne zespoły robocze",color:C_L,day:1,weeks:[1,3,5,8,10,12,14,16],start:"17:15",end:"19:00",place:"EA 401",teacher:"dr inż. Jerzy Dembski"},
{id:"ED",title:"Eksploracja danych",color:C_L,day:1,weeks:[1,3,5,8,10,12,14,16],start:"19:15",end:"21:00",place:"WP 103",teacher:"mgr inż. Dariusz Kobiela"},
  
{id:"PG",title:"Projekt grupowy II",color:C_P,day:2,weeks:[1,2,15,16],start:"08:15",end:"10:00",place:"NE AUD1L",teacher:"dr inż. Sławomir Gajewski"},
{id:"ZBS",title:"Zarządzanie bezpieczeństwem sieci",color:C_W,day:2,weeks:[1,2,3,4,5,6,8],start:"10:15",end:"12:00",place:"NE AUD1P",teacher:"dr inż. Michał Hoeft"},
{id:"ZFI",title:"Zarządzanie firmą informatyczną",color:C_W,day:2,weeks:[9,10,11,12,13,14,15,16],start:"10:15",end:"12:00",place:"NE AUD1P",teacher:"dr inż. Paweł Jakóbczyk"},
{id:"WZR",title:"Wirtualne zespoły robocze",color:C_W,day:2,weeks:[1,2,3,4,5,6,8,9,10,11,12,13,14,15,16],start:"12:15",end:"13:00",place:"EA AUD1",teacher:"prof. Bogdan Wiszniewski"},
{id:"SDI",title:"Seminarium dyplomowe inżynierskie I - zajęcia nieregularne",color:C_S,day:2,weeks:[1,2,3,4,5,6,8,9,10,11,12,13,14,15,16],start:"16:15",end:"19:00",place:"NE 310",teacher:"dr inż. Jarosław Kuchta"},

{id:"ZBI",title:"Zarządzanie bezpieczeństwem sieci",color:C_L,day:3,weeks:[1,3,5,8,10,12,14,16],start:"07:15",end:"10:00",place:"EA 204",teacher:"mgr inż. Jan Kornacki"},
{id:"BW",title:"Bazy wiedzy",color:C_L,day:3,weeks:[9,10,11,12,13,14,15,16],start:"10:15",end:"12:00",place:"WP 122",teacher:"dr inż. Wojciech Waloszek"},
{id:"BSK",title:"Bezpieczeństwo systemów komputerowych",color:C_P,day:3,weeks:[1,2,3,4,5,7,8,9,10,11,12,13,14,15,16],start:"12:15",end:"13:00",place:"NE 109",teacher:"dr inż. Andrzej Marczak"},
{id:"KSR",title:"Komponentowe systemy rozproszone",color:C_L,day:3,weeks:[1,2,3,4,5,7,8,9,10,11,12,13,14,15,16],start:"13:15",end:"15:00",place:"WP 108",teacher:"mgr inż. Tomasz Goluch"},
{id:"JO",title:"Jakość oprogramowania",color:C_P,day:3,weeks:[1,3,5,8,10,12,14,16],start:"16:15",end:"18:00",place:"Zajęcia zdalne",teacher:"dr inż. Adam Kaczmarek"},

{id:"TRP",title:"Technika radia programowalnego dla info - przedmiot obieralny",color:C_L,day:4,weeks:[10,11,12,13,14,16],start:"11:15",end:"14:00",place:"EA 407",teacher:"dr inż. Andrzej Marczak"},
{id:"RPI",title:"Realizacja projektu informatycznego",color:C_W,day:4,weeks:[1,2,3,4,5,6,7],start:"12:15",end:"14:00",place:"NE AUD1L",teacher:"dr inż. Jakub Miler"},
{id:"TRP",title:"Technika radia programowalnego dla info - zajęcia wprowadzające",color:C_L,day:4,weeks:[1],start:"12:15",end:"14:00",place:"NE 206",teacher:"dr inż. Andrzej Marczak"},
{id:"BSK",title:"Bezpieczeństwo systemów komputerowych",color:C_W,day:4,weeks:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,16],start:"14:15",end:"16:00",place:"EA AUD2",teacher:"dr inż. Piotr Rajchowski"},
{id:"KSR",title:"Komponentowe systemy rozproszone",color:C_W,day:4,weeks:[1,2,3,4,5,6,7],start:"16:15",end:"18:00",place:"NE AUD1L",teacher:"dr inż. Krzysztof Manuszewski"},

{id:"JO",title:"Jakość oprogramowania",color:C_W,day:5,weeks:[1,2,3,4,5,7,8,9,11,12,13,14,15,16],start:"11:15",end:"12:00",place:"NE AUD1P",teacher:"dr inż. Jarosław Kuchta"},
{id:"JO",title:"Jakość oprogramowania - zajęcia wprowadzające",color:C_P,day:5,weeks:[1],start:"16:15",end:"18:00",place:"EA AUD2",teacher:"dr inż. Adam Kaczmarek"},
  
{id:"JO",title:"Jakość oprogramowania",color:C_W,day:3,weeks:[6],start:"11:15",end:"12:00",place:"NE AUD1P",teacher:"dr inż. Jarosław Kuchta"},//1.04

{id:"XFR",title:"Wielki Piątek",day:5,start:"07:30",end:"22:00",place:"",teacher:"",color:"#818181ff",weeks:[6]},
{id:"XHL",title:"Poniedziałek Wielkanocny",day:1,start:"07:30",end:"22:00",place:"",teacher:"",color:"#ff4a4aff",weeks:[7]},
{id:"XFR",title:"Dzień wolny",day:2,start:"07:30",end:"22:00",place:"",teacher:"",color:"#818181ff",weeks:[7]},
{id:"XHL",title:"Święto Pracy",day:5,start:"07:30",end:"22:00",place:"",teacher:"",color:"#ff4a4aff",weeks:[10]},
{id:"XHL",title:"Boże Ciało",day:4,start:"07:30",end:"22:00",place:"",teacher:"",color:"#ff4a4aff",weeks:[15]},
],DAYS=["Poniedziałek","Wtorek","Środa","Czwartek","Piątek"],startHour=7,endHour=22,slotHeight=36,minutesPerSlot=30,timetable=document.getElementById("timetable"),timesCol=document.getElementById("timesCol"),weekSelect=document.getElementById("weekSelect"),daySelect=document.getElementById("daySelect"),todayBtn=document.getElementById("todayBtn");function buildWeekSelect(){weekSelect.innerHTML="";for(let e=1;e<=SEMESTER_WEEKS;e++){const{start:t,end:a}=weekDateRange(e),r=document.createElement("option");r.value=e,r.textContent=`${e}. (${fmtDM(t)} - ${fmtDM(a)})`,weekSelect.appendChild(r)}weekSelect.value=1}function buildDaySelect(){daySelect.innerHTML="";for(let e=0;e<DAYS.length;e++){const t=document.createElement("option");t.value=e+1,t.textContent=DAYS[e],daySelect.appendChild(t)}daySelect.value=1}function buildLayout(){timesCol.innerHTML="";for(let e=startHour;e<endHour;e++){const t=document.createElement("div");t.className="time-slot",t.textContent=`${String(e).padStart(2,"0")}:00`,t.style.color="rgb(220,220,220)";const a=document.createElement("div");a.className="time-slot",a.textContent=`${String(e).padStart(2,"0")}:30`,a.style.color="rgb(110,110,110)",timesCol.appendChild(t),timesCol.appendChild(a)}Array.from(timetable.querySelectorAll(".day-col")).forEach((e=>e.remove()));const e=Number(weekSelect.value)||1,t=new Date(SEMESTER_START);t.setDate(t.getDate()+7*(e-1));for(let e=0;e<DAYS.length;e++){const a=document.createElement("div");a.className="day-col",a.dataset.day=e+1;const r=document.createElement("div");r.className="day-header";const n=new Date(t);n.setDate(t.getDate()+e),r.textContent=`${DAYS[e]} ${fmtDM(n)}`,a.appendChild(r);const o=60/minutesPerSlot*(endHour-startHour);a.style.minHeight=o*slotHeight+"px",timetable.appendChild(a)}const a=window.matchMedia("(max-width:760px)").matches;timetable.style.gridTemplateColumns=a?"60px 1fr":`60px repeat(${DAYS.length},1fr)`}function parseTime(e){const[t,a]=e.split(":").map(Number);return 60*t+a}function minutesToTop(e){return(e-60*startHour)/minutesPerSlot*slotHeight}function formatWeeks(e){if(!e||!e.length)return"";const t=[...new Set(e)].sort(((e,t)=>e-t)),a=[];let r=t[0],n=t[0];for(let e=1;e<t.length;e++){const o=t[e];o===n+1?n=o:(a.push(r===n?String(r):`${r}-${n}`),r=n=o)}return a.push(r===n?String(r):`${r}-${n}`),a.join(",")}function eventOccursInWeek(e,t){return!e.weeks||Array.isArray(e.weeks)&&-1!==e.weeks.indexOf(t)}function clearRendered(){timetable.querySelectorAll(".day-col").forEach((e=>{Array.from(e.querySelectorAll(".event")).forEach((e=>e.remove())),Array.from(e.querySelectorAll(".now-line")).forEach((e=>e.remove()))}))}function renderEvents(){clearRendered();const e=Number(weekSelect.value),t=window.matchMedia("(max-width:760px)").matches,a=daySelect?Number(daySelect.value):null;timetable.style.gridTemplateColumns=t?"60px 1fr":`60px repeat(${DAYS.length},1fr)`,document.querySelectorAll(".day-col").forEach((e=>{e.style.display=t&&a?Number(e.dataset.day)===a?"block":"none":"block"}));for(const r of EVENTS){if(!eventOccursInWeek(r,e))continue;if(t&&a&&Number(r.day)!==a)continue;const n=timetable.querySelector(`.day-col[data-day='${r.day}']`);if(!n)continue;const o=parseTime(r.start)+16,l=parseTime(r.end)+23,i=minutesToTop(o),c=Math.max(28,(l-o)/minutesPerSlot*slotHeight-6),d=document.createElement("div");d.className="event",d.style.top=i+"px",d.style.height=c+"px",d.style.background=r.color||"#60a5fa",d.dataset.id=r.id,d.innerHTML=`\n          <div class="title">${escapeHtml(r.title)}</div>\n          <div class="meta">${escapeHtml(r.place||"")}${r.teacher?" • "+escapeHtml(r.teacher):""}</div>\n          <div class="time">${r.start} — ${r.end}</div>\n          <div class="weeks">Tyg.: ${escapeHtml(formatWeeks(r.weeks))}</div>\n        `,n.appendChild(d)}updateNowLine()}function escapeHtml(e){return e?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"):""}function goToToday(){const e=normalizeToStudyDay(new Date),t=weekNumberForDate(e),a=e.getDay(),r=a>=1&&a<=5?a:1;weekSelect.value=t,daySelect&&(daySelect.value=r),buildLayout(),renderEvents(),window.scrollTo({top:0,behavior:"smooth"})}function updateNowLine(){document.querySelectorAll(".now-line").forEach((e=>e.remove()));const e=new Date;if(weekNumberForDate(e)!==Number(weekSelect.value))return;const t=60*e.getHours()+e.getMinutes();if(t<60*startHour||t>60*endHour)return;const a=minutesToTop(t)+18,r=window.matchMedia("(max-width:760px)").matches,n=daySelect?Number(daySelect.value):null;document.querySelectorAll(".day-col").forEach((e=>{const t=Number(e.dataset.day);if(r&&n&&t!==n)return;if(t!==(new Date).getDay())return;const o=document.createElement("div");o.className="now-line",o.style.top=a+"px",e.appendChild(o)}))}buildWeekSelect(),buildDaySelect(),buildLayout(),goToToday(),weekSelect.addEventListener("change",(()=>{buildLayout(),renderEvents()})),daySelect.addEventListener("change",renderEvents),todayBtn.addEventListener("click",goToToday),window.addEventListener("resize",(()=>{buildLayout(),requestAnimationFrame(renderEvents)})),setInterval(updateNowLine,600);
